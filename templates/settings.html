<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - TimeTracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">TimeTracker</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-cog me-2"></i>Settings</h2>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save me-1"></i>Save Settings
                    </button>
                </div>

                <div class="row">
                    <!-- Appearance Settings -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-palette me-2"></i>Appearance</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="theme_preference" class="form-label">Theme Preference</label>
                                    <select class="form-select" id="theme_preference" name="theme_preference">
                                        <option value="auto">Auto (Follow System)</option>
                                        <option value="light">Light Mode</option>
                                        <option value="dark">Dark Mode</option>
                                    </select>
                                    <div class="form-text">Choose your preferred color theme</div>
                                </div>
                                <div class="mb-3">
                                    <label for="language" class="form-label">Language</label>
                                    <select class="form-select" id="language" name="language">
                                        <option value="en" selected>English</option>
                                        <option value="es">Español</option>
                                        <option value="fr">Français</option>
                                        <option value="de">Deutsch</option>
                                    </select>
                                    <div class="form-text">Select your preferred language</div>
                                </div>
                                <div class="mb-3">
                                    <label for="time_format" class="form-label">Time Format</label>
                                    <select class="form-select" id="time_format" name="time_format">
                                        <option value="12">12 Hour (AM/PM)</option>
                                        <option value="24" selected>24 Hour</option>
                                    </select>
                                    <div class="form-text">Choose how time is displayed</div>
                                </div>
                            </div>
                        </div>

                        <!-- Time Tracking Settings -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Time Tracking</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="default_project" class="form-label">Default Project</label>
                                    <select class="form-select" id="default_project" name="default_project">
                                        <option value="">No Default Project</option>
                                        <!-- Projects will be loaded via JavaScript -->
                                    </select>
                                    <div class="form-text">Automatically select this project when clocking in</div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="auto_break_reminder" name="auto_break_reminder">
                                        <label class="form-check-label" for="auto_break_reminder">
                                            Break Reminders
                                        </label>
                                    </div>
                                    <div class="form-text">Remind me to take breaks during long work sessions</div>
                                </div>
                                <div class="mb-3">
                                    <label for="break_interval" class="form-label">Break Reminder Interval (hours)</label>
                                    <input type="number" class="form-control" id="break_interval" name="break_interval" min="1" max="8" value="2">
                                    <div class="form-text">How often to remind about breaks</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Notifications</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="email_notifications" name="email_notifications" checked>
                                        <label class="form-check-label" for="email_notifications">
                                            Email Notifications
                                        </label>
                                    </div>
                                    <div class="form-text">Receive notifications via email</div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="browser_notifications" name="browser_notifications">
                                        <label class="form-check-label" for="browser_notifications">
                                            Browser Notifications
                                        </label>
                                    </div>
                                    <div class="form-text">Show notifications in your browser</div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="overtime_alerts" name="overtime_alerts" checked>
                                        <label class="form-check-label" for="overtime_alerts">
                                            Overtime Alerts
                                        </label>
                                    </div>
                                    <div class="form-text">Get notified when approaching overtime</div>
                                </div>
                            </div>
                        </div>

                        <!-- Privacy & Security -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Privacy & Security</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="location_tracking" name="location_tracking">
                                        <label class="form-check-label" for="location_tracking">
                                            Location Tracking
                                        </label>
                                    </div>
                                    <div class="form-text">Allow location tracking for time entries</div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="activity_logging" name="activity_logging" checked>
                                        <label class="form-check-label" for="activity_logging">
                                            Activity Logging
                                        </label>
                                    </div>
                                    <div class="form-text">Log detailed activity for time tracking</div>
                                </div>
                                <div class="mb-3">
                                    <label for="session_timeout" class="form-label">Session Timeout (minutes)</label>
                                    <select class="form-select" id="session_timeout" name="session_timeout">
                                        <option value="30">30 minutes</option>
                                        <option value="60">1 hour</option>
                                        <option value="120" selected>2 hours</option>
                                        <option value="240">4 hours</option>
                                        <option value="480">8 hours</option>
                                    </select>
                                    <div class="form-text">Automatically log out after inactivity</div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-database me-2"></i>Data Management</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="exportData()">
                                        <i class="fas fa-download me-1"></i>Export My Data
                                    </button>
                                    <div class="form-text">Download all your time tracking data</div>
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="clearCache()">
                                        <i class="fas fa-broom me-1"></i>Clear Cache
                                    </button>
                                    <div class="form-text">Clear browser cache and stored data</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script>
        // Load current theme preference on page load
        document.addEventListener('DOMContentLoaded', function() {
            const currentTheme = localStorage.getItem('theme') || 'auto';
            document.getElementById('theme_preference').value = currentTheme;

            loadProjects();

            // Set up theme preference change handler
            document.getElementById('theme_preference').addEventListener('change', function() {
                const selectedTheme = this.value;
                if (selectedTheme === 'auto') {
                    localStorage.removeItem('theme');
                    const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    window.themeManager.setTheme(systemPreference);
                } else {
                    window.themeManager.setTheme(selectedTheme);
                }
            });
        });

        function loadProjects() {
            fetch('/api/projects')
            .then(response => response.json())
            .then(projects => {
                const projectSelect = document.getElementById('default_project');
                projectSelect.innerHTML = '<option value="">No Default Project</option>';
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = `${project.name} (${project.project_code || 'No Code'})`;
                    projectSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading projects:', error);
            });
        }

        function saveSettings() {
            const formData = {
                theme_preference: document.getElementById('theme_preference').value,
                language: document.getElementById('language').value,
                time_format: document.getElementById('time_format').value,
                default_project: document.getElementById('default_project').value,
                auto_break_reminder: document.getElementById('auto_break_reminder').checked,
                break_interval: document.getElementById('break_interval').value,
                email_notifications: document.getElementById('email_notifications').checked,
                browser_notifications: document.getElementById('browser_notifications').checked,
                overtime_alerts: document.getElementById('overtime_alerts').checked,
                location_tracking: document.getElementById('location_tracking').checked,
                activity_logging: document.getElementById('activity_logging').checked,
                session_timeout: document.getElementById('session_timeout').value
            };

            fetch('/settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving settings');
            });
        }

        function exportData() {
            // This would trigger a data export
            alert('Data export functionality would be implemented here');
        }

        function clearCache() {
            if (confirm('Are you sure you want to clear all cached data? This will reset your preferences.')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('Cache cleared successfully. Please refresh the page.');
            }
        }
    </script>
</body>
</html>